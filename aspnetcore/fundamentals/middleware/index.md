---
title: Middleware de ASP.NET Core
author: rick-anderson
description: Obtenga información sobre el middleware de ASP.NET Core y la canalización de solicitudes.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 5/6/2020
no-loc:
- Blazor
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/middleware/index
ms.openlocfilehash: 81a0da65215bc41f6dfad0de28a95bdc455bd8fb
ms.sourcegitcommit: 5e462c3328c70f95969d02adce9c71592049f54c
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 06/24/2020
ms.locfileid: "85292794"
---
# <a name="aspnet-core-middleware"></a><span data-ttu-id="cb31c-103">Middleware de ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="cb31c-103">ASP.NET Core Middleware</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="cb31c-104">Por [Rick Anderson](https://twitter.com/RickAndMSFT) y [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="cb31c-104">By [Rick Anderson](https://twitter.com/RickAndMSFT) and [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="cb31c-105">El software intermedio es un software que se ensambla en una canalización de una aplicación para controlar las solicitudes y las respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-105">Middleware is software that's assembled into an app pipeline to handle requests and responses.</span></span> <span data-ttu-id="cb31c-106">Cada componente puede hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="cb31c-106">Each component:</span></span>

* <span data-ttu-id="cb31c-107">Elegir si se pasa la solicitud al siguiente componente de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-107">Chooses whether to pass the request to the next component in the pipeline.</span></span>
* <span data-ttu-id="cb31c-108">Realizar trabajos antes y después del siguiente componente de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-108">Can perform work before and after the next component in the pipeline.</span></span>

<span data-ttu-id="cb31c-109">Los delegados de solicitudes se usan para crear la canalización de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-109">Request delegates are used to build the request pipeline.</span></span> <span data-ttu-id="cb31c-110">Estos también controlan las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="cb31c-110">The request delegates handle each HTTP request.</span></span>

<span data-ttu-id="cb31c-111">Los delegados de solicitudes se configuran con los métodos de extensión <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*>, <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*> y <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-111">Request delegates are configured using <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*>, <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*>, and <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*> extension methods.</span></span> <span data-ttu-id="cb31c-112">Un delegado de solicitudes se puede especificar en línea como un método anónimo (denominado middleware en línea) o se puede definir en una clase reutilizable.</span><span class="sxs-lookup"><span data-stu-id="cb31c-112">An individual request delegate can be specified in-line as an anonymous method (called in-line middleware), or it can be defined in a reusable class.</span></span> <span data-ttu-id="cb31c-113">Estas clases reutilizables y métodos anónimos en línea se conocen como *software intermedio* o *componentes de software intermedio*.</span><span class="sxs-lookup"><span data-stu-id="cb31c-113">These reusable classes and in-line anonymous methods are *middleware*, also called *middleware components*.</span></span> <span data-ttu-id="cb31c-114">Cada componente de software intermedio de la canalización de solicitudes es responsable de invocar el siguiente componente de la canalización o de cortocircuitar la canalización, en caso de ser necesario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-114">Each middleware component in the request pipeline is responsible for invoking the next component in the pipeline or short-circuiting the pipeline.</span></span> <span data-ttu-id="cb31c-115">Cuando un middleware se cortocircuita, se llama *middleware de terminal* porque impide el procesamiento de la solicitud por parte de middleware adicional.</span><span class="sxs-lookup"><span data-stu-id="cb31c-115">When a middleware short-circuits, it's called a *terminal middleware* because it prevents further middleware from processing the request.</span></span>

<span data-ttu-id="cb31c-116">En <xref:migration/http-modules> se explica la diferencia entre las canalizaciones de solicitudes en ASP.NET Core y ASP.NET 4.x y se proporcionan ejemplos adicionales de middleware.</span><span class="sxs-lookup"><span data-stu-id="cb31c-116"><xref:migration/http-modules> explains the difference between request pipelines in ASP.NET Core and ASP.NET 4.x and provides additional middleware samples.</span></span>

## <a name="create-a-middleware-pipeline-with-iapplicationbuilder"></a><span data-ttu-id="cb31c-117">Creación de una canalización de software intermedio con IApplicationBuilder</span><span class="sxs-lookup"><span data-stu-id="cb31c-117">Create a middleware pipeline with IApplicationBuilder</span></span>

<span data-ttu-id="cb31c-118">La canalización de solicitudes de ASP.NET Core consiste en una secuencia de delegados de solicitud a los que se llama de uno en uno.</span><span class="sxs-lookup"><span data-stu-id="cb31c-118">The ASP.NET Core request pipeline consists of a sequence of request delegates, called one after the other.</span></span> <span data-ttu-id="cb31c-119">En el siguiente diagrama se muestra este concepto.</span><span class="sxs-lookup"><span data-stu-id="cb31c-119">The following diagram demonstrates the concept.</span></span> <span data-ttu-id="cb31c-120">El subproceso de ejecución sigue las flechas negras.</span><span class="sxs-lookup"><span data-stu-id="cb31c-120">The thread of execution follows the black arrows.</span></span>

![En el patrón de procesamiento de solicitudes se muestra una solicitud entrante, el procesamiento a través de tres softwares intermedios y la respuesta saliente de la aplicación.](index/_static/request-delegate-pipeline.png)

<span data-ttu-id="cb31c-124">Cada delegado puede realizar operaciones antes y después del siguiente.</span><span class="sxs-lookup"><span data-stu-id="cb31c-124">Each delegate can perform operations before and after the next delegate.</span></span> <span data-ttu-id="cb31c-125">Los delegados que controlan excepciones deben llamarse al principio de la canalización para que puedan capturar las excepciones que se producen en las fases siguientes de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-125">Exception-handling delegates should be called early in the pipeline, so they can catch exceptions that occur in later stages of the pipeline.</span></span>

<span data-ttu-id="cb31c-126">La aplicación ASP.NET Core más sencilla posible configura un solo delegado de solicitudes que controla todas las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-126">The simplest possible ASP.NET Core app sets up a single request delegate that handles all requests.</span></span> <span data-ttu-id="cb31c-127">En este caso no se incluye una canalización de solicitudes real.</span><span class="sxs-lookup"><span data-stu-id="cb31c-127">This case doesn't include an actual request pipeline.</span></span> <span data-ttu-id="cb31c-128">En su lugar, solo se llama a una única función anónima en respuesta a todas las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="cb31c-128">Instead, a single anonymous function is called in response to every HTTP request.</span></span>

[!code-csharp[](index/snapshot/Middleware/Startup.cs)]

<span data-ttu-id="cb31c-129">Encadene varios delegados de solicitudes con <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-129">Chain multiple request delegates together with <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>.</span></span> <span data-ttu-id="cb31c-130">El parámetro `next` representa el siguiente delegado de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-130">The `next` parameter represents the next delegate in the pipeline.</span></span> <span data-ttu-id="cb31c-131">Si *no* llama al *siguiente* parámetro, puede cortocircuitar la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-131">You can short-circuit the pipeline by *not* calling the *next* parameter.</span></span> <span data-ttu-id="cb31c-132">Normalmente, puede realizar acciones antes y después del siguiente delegado, tal como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="cb31c-132">You can typically perform actions both before and after the next delegate, as the following example demonstrates:</span></span>

[!code-csharp[](index/snapshot/Chain/Startup.cs?highlight=5-10)]

<span data-ttu-id="cb31c-133">Cuando un delegado no pasa una solicitud al siguiente delegado, se denomina *cortocircuitar la canalización de solicitudes*.</span><span class="sxs-lookup"><span data-stu-id="cb31c-133">When a delegate doesn't pass a request to the next delegate, it's called *short-circuiting the request pipeline*.</span></span> <span data-ttu-id="cb31c-134">Este proceso es necesario muchas veces, ya que previene la realización de trabajo innecesario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-134">Short-circuiting is often desirable because it avoids unnecessary work.</span></span> <span data-ttu-id="cb31c-135">Por ejemplo, el [middleware de archivos estáticos](xref:fundamentals/static-files) puede actuar como *middleware de terminal* procesando una solicitud para un archivo estático y cortocircuitando el resto de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-135">For example, [Static File Middleware](xref:fundamentals/static-files) can act as a *terminal middleware* by processing a request for a static file and short-circuiting the rest of the pipeline.</span></span> <span data-ttu-id="cb31c-136">El middleware agregado a la canalización antes del middleware que finaliza el procesamiento sigue procesando código después de sus instrucciones `next.Invoke`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-136">Middleware added to the pipeline before the middleware that terminates further processing still processes code after their `next.Invoke` statements.</span></span> <span data-ttu-id="cb31c-137">Sin embargo, consulte la siguiente advertencia sobre intentar escribir en una respuesta que ya se ha enviado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-137">However, see the following warning about attempting to write to a response that has already been sent.</span></span>

> [!WARNING]
> <span data-ttu-id="cb31c-138">No llame a `next.Invoke` después de haber enviado la respuesta al cliente.</span><span class="sxs-lookup"><span data-stu-id="cb31c-138">Don't call `next.Invoke` after the response has been sent to the client.</span></span> <span data-ttu-id="cb31c-139">Si se modifica <xref:Microsoft.AspNetCore.Http.HttpResponse> después de haber iniciado la respuesta, se producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="cb31c-139">Changes to <xref:Microsoft.AspNetCore.Http.HttpResponse> after the response has started throw an exception.</span></span> <span data-ttu-id="cb31c-140">Por ejemplo, se producirá una excepción al realizar cambios tales como el establecimiento de encabezados o el código.</span><span class="sxs-lookup"><span data-stu-id="cb31c-140">For example, changes such as setting headers and a status code throw an exception.</span></span> <span data-ttu-id="cb31c-141">Si escribe en el cuerpo de la respuesta después de llamar a `next`:</span><span class="sxs-lookup"><span data-stu-id="cb31c-141">Writing to the response body after calling `next`:</span></span>
>
> * <span data-ttu-id="cb31c-142">Puede provocar una infracción del protocolo.</span><span class="sxs-lookup"><span data-stu-id="cb31c-142">May cause a protocol violation.</span></span> <span data-ttu-id="cb31c-143">Por ejemplo, si escribe más de la longitud `Content-Length` establecida.</span><span class="sxs-lookup"><span data-stu-id="cb31c-143">For example, writing more than the stated `Content-Length`.</span></span>
> * <span data-ttu-id="cb31c-144">Puede dañar el formato del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="cb31c-144">May corrupt the body format.</span></span> <span data-ttu-id="cb31c-145">Por ejemplo, si escribe un pie de página en HTML en un archivo CSS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-145">For example, writing an HTML footer to a CSS file.</span></span>
>
> <span data-ttu-id="cb31c-146"><xref:Microsoft.AspNetCore.Http.HttpResponse.HasStarted*> es una sugerencia útil para indicar si se han enviado los encabezados o se han realizado escrituras en el cuerpo.</span><span class="sxs-lookup"><span data-stu-id="cb31c-146"><xref:Microsoft.AspNetCore.Http.HttpResponse.HasStarted*> is a useful hint to indicate if headers have been sent or the body has been written to.</span></span>

<span data-ttu-id="cb31c-147">Los delegados de <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*> no reciben un parámetro `next`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-147"><xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*> delegates don't receive a `next` parameter.</span></span> <span data-ttu-id="cb31c-148">El primer delegado de `Run` siempre es terminal y finaliza la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-148">The first `Run` delegate is always terminal and terminates the pipeline.</span></span> <span data-ttu-id="cb31c-149">`Run` es una convención.</span><span class="sxs-lookup"><span data-stu-id="cb31c-149">`Run` is a convention.</span></span> <span data-ttu-id="cb31c-150">Es posible que algunos componentes de middleware expongan métodos `Run[Middleware]` que se ejecutan al final de la canalización:</span><span class="sxs-lookup"><span data-stu-id="cb31c-150">Some middleware components may expose `Run[Middleware]` methods that run at the end of the pipeline:</span></span>

[!code-csharp[](index/snapshot/Chain/Startup.cs?highlight=12-15)]
[!INCLUDE[about the series](~/includes/code-comments-loc.md)]

<span data-ttu-id="cb31c-151">En el ejemplo anterior, el delegado `Run` escribe `"Hello from 2nd delegate."` en la respuesta y, después, termina la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-151">In the preceding example, the `Run` delegate writes `"Hello from 2nd delegate."` to the response and then terminates the pipeline.</span></span> <span data-ttu-id="cb31c-152">Si se agrega otro delegado `Use` o `Run` después de `Run`, no se le llama.</span><span class="sxs-lookup"><span data-stu-id="cb31c-152">If another `Use` or `Run` delegate is added after the `Run` delegate, it's not called.</span></span>

<a name="order"></a>

## <a name="middleware-order"></a><span data-ttu-id="cb31c-153">Orden del middleware</span><span class="sxs-lookup"><span data-stu-id="cb31c-153">Middleware order</span></span>

<span data-ttu-id="cb31c-154">En el diagrama siguiente se muestra la canalización de procesamiento de solicitudes completa para las aplicaciones de ASP.NET Core MVC y de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="cb31c-154">The following diagram shows the complete request processing pipeline for ASP.NET Core MVC and Razor Pages apps.</span></span> <span data-ttu-id="cb31c-155">Puede ver cómo, en una aplicación típica, se ordenan los middleware existentes y dónde se agregan los middleware personalizados.</span><span class="sxs-lookup"><span data-stu-id="cb31c-155">You can see how, in a typical app, existing middlewares are ordered and where custom middlewares are added.</span></span> <span data-ttu-id="cb31c-156">Tiene control total sobre cómo reordenar los middleware existentes o insertar nuevos middleware personalizados según sea necesario para sus escenarios.</span><span class="sxs-lookup"><span data-stu-id="cb31c-156">You have full control over how to reorder existing middlewares or inject new custom middlewares as necessary for your scenarios.</span></span>

![Canalización de middleware de ASP.NET Core](index/_static/middleware-pipeline.svg)

<span data-ttu-id="cb31c-158">El middleware **Punto de conexión** del diagrama anterior ejecuta la canalización de filtro para el tipo de aplicación correspondiente &mdash;MVC o Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="cb31c-158">The **Endpoint** middleware in the preceding diagram executes the filter pipeline for the corresponding app type&mdash;MVC or Razor Pages.</span></span>

![Canalización de filtro de ASP.NET Core](index/_static/mvc-endpoint.svg)

<span data-ttu-id="cb31c-160">El orden en el que se agregan los componentes de software intermedio en el método `Startup.Configure` define el orden en el que se invocarán los componentes de software intermedio en las solicitudes y el orden inverso de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="cb31c-160">The order that middleware components are added in the `Startup.Configure` method defines the order in which the middleware components are invoked on requests and the reverse order for the response.</span></span> <span data-ttu-id="cb31c-161">Por motivos de seguridad, rendimiento y funcionalidad, el orden es **crítico**.</span><span class="sxs-lookup"><span data-stu-id="cb31c-161">The order is **critical** for security, performance, and functionality.</span></span>

<span data-ttu-id="cb31c-162">El método `Startup.Configure` siguiente agrega componentes de middleware relacionados con la seguridad en el orden recomendado:</span><span class="sxs-lookup"><span data-stu-id="cb31c-162">The following `Startup.Configure` method adds security-related middleware components in the recommended order:</span></span>

[!code-csharp[](index/snapshot/StartupAll3.cs?name=snippet)]

<span data-ttu-id="cb31c-163">En el código anterior:</span><span class="sxs-lookup"><span data-stu-id="cb31c-163">In the preceding code:</span></span>

* <span data-ttu-id="cb31c-164">El middleware que no se agrega al crear una aplicación web con [cuentas de usuario individuales](xref:security/authentication/identity) se convierte en comentario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-164">Middleware that is not added when creating a new web app with [individual users accounts](xref:security/authentication/identity) is commented out.</span></span>
* <span data-ttu-id="cb31c-165">No todo el middleware tiene que ir en este orden exacto, pero gran parte sí lo hace.</span><span class="sxs-lookup"><span data-stu-id="cb31c-165">Not every middleware needs to go in this exact order, but many do.</span></span> <span data-ttu-id="cb31c-166">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="cb31c-166">For example:</span></span>
  * <span data-ttu-id="cb31c-167">Por ejemplo, `UseCors`, `UseAuthentication` y `UseAuthorization` deben ir en el orden mostrado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-167">`UseCors`, `UseAuthentication`, and `UseAuthorization` must go in the order shown.</span></span>
  * <span data-ttu-id="cb31c-168">`UseCors` actualmente debe ir antes de `UseResponseCaching` debido a [este error](https://github.com/dotnet/aspnetcore/issues/23218).</span><span class="sxs-lookup"><span data-stu-id="cb31c-168">`UseCors` currently must go before `UseResponseCaching` due to [this bug](https://github.com/dotnet/aspnetcore/issues/23218).</span></span>

<span data-ttu-id="cb31c-169">El siguiente método `Startup.Configure` agrega los componentes de middleware para escenarios de aplicaciones comunes:</span><span class="sxs-lookup"><span data-stu-id="cb31c-169">The following `Startup.Configure` method adds middleware components for common app scenarios:</span></span>

1. <span data-ttu-id="cb31c-170">Control de errores y excepciones</span><span class="sxs-lookup"><span data-stu-id="cb31c-170">Exception/error handling</span></span>
   * <span data-ttu-id="cb31c-171">Cuando la aplicación se ejecuta en el entorno de desarrollo:</span><span class="sxs-lookup"><span data-stu-id="cb31c-171">When the app runs in the Development environment:</span></span>
     * <span data-ttu-id="cb31c-172">El middleware de la página de excepciones para el desarrollador (<xref:Microsoft.AspNetCore.Builder.DeveloperExceptionPageExtensions.UseDeveloperExceptionPage*>) informa los errores en tiempo de ejecución de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-172">Developer Exception Page Middleware (<xref:Microsoft.AspNetCore.Builder.DeveloperExceptionPageExtensions.UseDeveloperExceptionPage*>) reports app runtime errors.</span></span>
     * <span data-ttu-id="cb31c-173">El middleware de la página de errores de la base de datos informa de los errores en tiempo de ejecución de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-173">Database Error Page Middleware reports database runtime errors.</span></span>
   * <span data-ttu-id="cb31c-174">Cuando la aplicación se ejecuta en el entorno de producción:</span><span class="sxs-lookup"><span data-stu-id="cb31c-174">When the app runs in the Production environment:</span></span>
     * <span data-ttu-id="cb31c-175">El middleware del controlador de excepciones (<xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*>) detecta las excepciones generadas en los middlewares siguientes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-175">Exception Handler Middleware (<xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*>) catches exceptions thrown in the following middlewares.</span></span>
     * <span data-ttu-id="cb31c-176">El middleware del protocolo de seguridad de transporte estricta de HTTP (HSTS) (<xref:Microsoft.AspNetCore.Builder.HstsBuilderExtensions.UseHsts*>) agrega el encabezado `Strict-Transport-Security`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-176">HTTP Strict Transport Security Protocol (HSTS) Middleware (<xref:Microsoft.AspNetCore.Builder.HstsBuilderExtensions.UseHsts*>) adds the `Strict-Transport-Security` header.</span></span>
1. <span data-ttu-id="cb31c-177">El middleware de redireccionamiento de HTTPS (<xref:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection*>) redirige las solicitudes HTTP a HTTPS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-177">HTTPS Redirection Middleware (<xref:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection*>) redirects HTTP requests to HTTPS.</span></span>
1. <span data-ttu-id="cb31c-178">El middleware de archivos estáticos (<xref:Microsoft.AspNetCore.Builder.StaticFileExtensions.UseStaticFiles*>) devuelve archivos estáticos y genera un cortocircuito más allá del procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="cb31c-178">Static File Middleware (<xref:Microsoft.AspNetCore.Builder.StaticFileExtensions.UseStaticFiles*>) returns static files and short-circuits further request processing.</span></span>
1. <span data-ttu-id="cb31c-179">El middleware de directivas de cookies (<xref:Microsoft.AspNetCore.Builder.CookiePolicyAppBuilderExtensions.UseCookiePolicy*>) permite que la aplicación cumpla con las normas del Reglamento general de protección de datos (RGPD) de la Unión Europea.</span><span class="sxs-lookup"><span data-stu-id="cb31c-179">Cookie Policy Middleware (<xref:Microsoft.AspNetCore.Builder.CookiePolicyAppBuilderExtensions.UseCookiePolicy*>) conforms the app to the EU General Data Protection Regulation (GDPR) regulations.</span></span>
1. <span data-ttu-id="cb31c-180">Middleware de enrutamiento (`UseRouting`) para enrutar las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-180">Routing Middleware (`UseRouting`) to route requests.</span></span>
1. <span data-ttu-id="cb31c-181">El middleware de autenticación (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>) intenta autenticar al usuarios antes de que se le permita acceder a los recursos protegidos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-181">Authentication Middleware (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>) attempts to authenticate the user before they're allowed access to secure resources.</span></span>
1. <span data-ttu-id="cb31c-182">El middleware de autorización (`UseAuthorization`) autoriza a los usuarios a acceder a los recursos seguros.</span><span class="sxs-lookup"><span data-stu-id="cb31c-182">Authorization Middleware (`UseAuthorization`) authorizes a user to access secure resources.</span></span>
1. <span data-ttu-id="cb31c-183">El middleware de sesiones (<xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession*>) establece y mantiene el estado de sesión.</span><span class="sxs-lookup"><span data-stu-id="cb31c-183">Session Middleware (<xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession*>) establishes and maintains session state.</span></span> <span data-ttu-id="cb31c-184">Si la aplicación usa el estado de sesión, llame al middleware de sesiones después del middleware de directivas de cookies y antes del middleware de MVC.</span><span class="sxs-lookup"><span data-stu-id="cb31c-184">If the app uses session state, call Session Middleware after Cookie Policy Middleware and before MVC Middleware.</span></span>
1. <span data-ttu-id="cb31c-185">Middleware de enrutamiento de punto de conexión (`UseEndpoints` con `MapRazorPages`) para agregar puntos de conexión de Razor Pages a la canalización de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-185">Endpoint Routing Middleware (`UseEndpoints` with `MapRazorPages`) to add Razor Pages endpoints to the request pipeline.</span></span>

<!--

FUTURE UPDATE

On the next topic overhaul/release update, add API crosslink to "Database Error Page Middleware" in Item 1 of the list ...

Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage*

... when available via the API docs.

-->

```csharp
public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
        app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }

    app.UseHttpsRedirection();
    app.UseStaticFiles();
    app.UseCookiePolicy();
    app.UseRouting();
    app.UseAuthentication();
    app.UseAuthorization();
    app.UseSession();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapRazorPages();
    });
}
```

<span data-ttu-id="cb31c-186">En el código de ejemplo anterior, cada método de extensión de software intermedio se expone en <xref:Microsoft.AspNetCore.Builder.IApplicationBuilder> a través del espacio de nombres de <xref:Microsoft.AspNetCore.Builder?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-186">In the preceding example code, each middleware extension method is exposed on <xref:Microsoft.AspNetCore.Builder.IApplicationBuilder> through the <xref:Microsoft.AspNetCore.Builder?displayProperty=fullName> namespace.</span></span>

<span data-ttu-id="cb31c-187"><xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*> es el primer componente de software intermedio que se agrega a la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-187"><xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*> is the first middleware component added to the pipeline.</span></span> <span data-ttu-id="cb31c-188">Por lo tanto, el software intermedio del controlador de excepciones detectará las excepciones que se produzcan en las llamadas posteriores.</span><span class="sxs-lookup"><span data-stu-id="cb31c-188">Therefore, the Exception Handler Middleware catches any exceptions that occur in later calls.</span></span>

<span data-ttu-id="cb31c-189">El software intermedio de archivos estáticos se llama al principio de la canalización para que pueda controlar solicitudes y realizar cortocircuitos sin pasar por los componentes restantes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-189">Static File Middleware is called early in the pipeline so that it can handle requests and short-circuit without going through the remaining components.</span></span> <span data-ttu-id="cb31c-190">Este middleware **no** proporciona comprobaciones de autorización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-190">The Static File Middleware provides **no** authorization checks.</span></span> <span data-ttu-id="cb31c-191">Los archivos que proporciona el middleware de archivos estáticos, incluidos los de *wwwroot*, están disponibles de forma pública.</span><span class="sxs-lookup"><span data-stu-id="cb31c-191">Any files served by Static File Middleware, including those under *wwwroot*, are publicly available.</span></span> <span data-ttu-id="cb31c-192">Para obtener más información sobre cómo proteger este tipo de archivos, vea <xref:fundamentals/static-files>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-192">For an approach to secure static files, see <xref:fundamentals/static-files>.</span></span>

<span data-ttu-id="cb31c-193">Si el software intermedio de archivos estáticos no controla la solicitud, se pasará al software intermedio de autenticación (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>), que realizará la autenticación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-193">If the request isn't handled by the Static File Middleware, it's passed on to the Authentication Middleware (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>), which performs authentication.</span></span> <span data-ttu-id="cb31c-194">Este software intermedio no cortocircuita las solicitudes sin autenticación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-194">Authentication doesn't short-circuit unauthenticated requests.</span></span> <span data-ttu-id="cb31c-195">Aunque autentique solicitudes, la autorización (y también el rechazo) se producirán después de que MVC seleccione una página de Razor o un control y una acción de MVC concretos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-195">Although Authentication Middleware authenticates requests, authorization (and rejection) occurs only after MVC selects a specific Razor Page or MVC controller and action.</span></span>

<span data-ttu-id="cb31c-196">En el ejemplo siguiente se muestra un orden de software intermedio en el que el software intermedio de archivos estáticos controla las solicitudes de archivos estáticos antes del software intermedio de compresión de respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-196">The following example demonstrates a middleware order where requests for static files are handled by Static File Middleware before Response Compression Middleware.</span></span> <span data-ttu-id="cb31c-197">Los archivos estáticos no se comprimen en este orden de software intermedio.</span><span class="sxs-lookup"><span data-stu-id="cb31c-197">Static files aren't compressed with this middleware order.</span></span> <span data-ttu-id="cb31c-198">Las respuestas de Razor Pages se pueden comprimir.</span><span class="sxs-lookup"><span data-stu-id="cb31c-198">The Razor Pages responses can be compressed.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    // Static files aren't compressed by Static File Middleware.
    app.UseStaticFiles();

    app.UseResponseCompression();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapRazorPages();
    });
}
```

<span data-ttu-id="cb31c-199">En el caso de las aplicaciones de página única (SPA), el middleware de SPA <xref:Microsoft.Extensions.DependencyInjection.SpaStaticFilesExtensions.UseSpaStaticFiles*> normalmente se incluye en último lugar en la canalización de middleware.</span><span class="sxs-lookup"><span data-stu-id="cb31c-199">For Single Page Applications (SPAs), the SPA middleware <xref:Microsoft.Extensions.DependencyInjection.SpaStaticFilesExtensions.UseSpaStaticFiles*> usually comes last in the middleware pipeline.</span></span> <span data-ttu-id="cb31c-200">El middleware de SPA se incluye en último lugar:</span><span class="sxs-lookup"><span data-stu-id="cb31c-200">The SPA middleware comes last:</span></span>

* <span data-ttu-id="cb31c-201">Para permitir que todos los demás middleware respondan a las solicitudes coincidentes primero.</span><span class="sxs-lookup"><span data-stu-id="cb31c-201">To allow all other middlewares to respond to matching requests first.</span></span>
* <span data-ttu-id="cb31c-202">Para permitir que SPA con enrutamiento del lado cliente se ejecuten para todas las rutas que no reconoce la aplicación de servidor.</span><span class="sxs-lookup"><span data-stu-id="cb31c-202">To allow SPAs with client-side routing to run for all routes that are unrecognized by the server app.</span></span>

<span data-ttu-id="cb31c-203">Para obtener más información sobre las SPA, consulte las guías de las plantillas de proyecto [React](xref:spa/react) y [Angular](xref:spa/angular).</span><span class="sxs-lookup"><span data-stu-id="cb31c-203">For more details on SPAs, see the guides for the [React](xref:spa/react) and [Angular](xref:spa/angular) project templates.</span></span>

### <a name="forwarded-headers-middleware-order"></a><span data-ttu-id="cb31c-204">Orden del middleware de encabezados reenviados</span><span class="sxs-lookup"><span data-stu-id="cb31c-204">Forwarded Headers Middleware order</span></span>

[!INCLUDE[](~/includes/ForwardedHeaders.md)]

## <a name="branch-the-middleware-pipeline"></a><span data-ttu-id="cb31c-205">Creación de una rama de la canalización de middleware</span><span class="sxs-lookup"><span data-stu-id="cb31c-205">Branch the middleware pipeline</span></span>

<span data-ttu-id="cb31c-206">Las extensiones <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*> se usan como convenciones para la creación de ramas en la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-206"><xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*> extensions are used as a convention for branching the pipeline.</span></span> <span data-ttu-id="cb31c-207">`Map` crea una rama de la canalización de solicitudes según las coincidencias de la ruta de solicitud proporcionada.</span><span class="sxs-lookup"><span data-stu-id="cb31c-207">`Map` branches the request pipeline based on matches of the given request path.</span></span> <span data-ttu-id="cb31c-208">Si la ruta de solicitud comienza con la ruta proporcionada, se ejecuta la creación de la rama.</span><span class="sxs-lookup"><span data-stu-id="cb31c-208">If the request path starts with the given path, the branch is executed.</span></span>

[!code-csharp[](index/snapshot/Chain/StartupMap.cs)]

<span data-ttu-id="cb31c-209">En la siguiente tabla se muestran las solicitudes y las respuestas de `http://localhost:1234` con el código anterior.</span><span class="sxs-lookup"><span data-stu-id="cb31c-209">The following table shows the requests and responses from `http://localhost:1234` using the previous code.</span></span>

| <span data-ttu-id="cb31c-210">Request</span><span class="sxs-lookup"><span data-stu-id="cb31c-210">Request</span></span>             | <span data-ttu-id="cb31c-211">Respuesta</span><span class="sxs-lookup"><span data-stu-id="cb31c-211">Response</span></span>                     |
| ------------------- | ---------------------------- |
| <span data-ttu-id="cb31c-212">localhost:1234</span><span class="sxs-lookup"><span data-stu-id="cb31c-212">localhost:1234</span></span>      | <span data-ttu-id="cb31c-213">Saludos del delegado sin Map.</span><span class="sxs-lookup"><span data-stu-id="cb31c-213">Hello from non-Map delegate.</span></span> |
| <span data-ttu-id="cb31c-214">localhost:1234/map1</span><span class="sxs-lookup"><span data-stu-id="cb31c-214">localhost:1234/map1</span></span> | <span data-ttu-id="cb31c-215">Prueba 1 de Map</span><span class="sxs-lookup"><span data-stu-id="cb31c-215">Map Test 1</span></span>                   |
| <span data-ttu-id="cb31c-216">localhost:1234/map2</span><span class="sxs-lookup"><span data-stu-id="cb31c-216">localhost:1234/map2</span></span> | <span data-ttu-id="cb31c-217">Prueba 2 de Map</span><span class="sxs-lookup"><span data-stu-id="cb31c-217">Map Test 2</span></span>                   |
| <span data-ttu-id="cb31c-218">localhost:1234/map3</span><span class="sxs-lookup"><span data-stu-id="cb31c-218">localhost:1234/map3</span></span> | <span data-ttu-id="cb31c-219">Saludos del delegado sin Map.</span><span class="sxs-lookup"><span data-stu-id="cb31c-219">Hello from non-Map delegate.</span></span> |

<span data-ttu-id="cb31c-220">Cuando se usa `Map`, los segmentos de ruta que coincidan se eliminan de `HttpRequest.Path` y se anexan a `HttpRequest.PathBase` para cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="cb31c-220">When `Map` is used, the matched path segments are removed from `HttpRequest.Path` and appended to `HttpRequest.PathBase` for each request.</span></span>

<span data-ttu-id="cb31c-221">`Map` admite la anidación, por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="cb31c-221">`Map` supports nesting, for example:</span></span>

```csharp
app.Map("/level1", level1App => {
    level1App.Map("/level2a", level2AApp => {
        // "/level1/level2a" processing
    });
    level1App.Map("/level2b", level2BApp => {
        // "/level1/level2b" processing
    });
});
```

<span data-ttu-id="cb31c-222">`Map` puede hacer coincidir varios segmentos a la vez:</span><span class="sxs-lookup"><span data-stu-id="cb31c-222">`Map` can also match multiple segments at once:</span></span>

[!code-csharp[](index/snapshot/Chain/StartupMultiSeg.cs?highlight=13)]

<span data-ttu-id="cb31c-223"><xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> crea una rama de la canalización de solicitudes según el resultado del predicado proporcionado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-223"><xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> branches the request pipeline based on the result of the given predicate.</span></span> <span data-ttu-id="cb31c-224">Se puede usar cualquier predicado de tipo `Func<HttpContext, bool>` para asignar solicitudes a nuevas ramas de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-224">Any predicate of type `Func<HttpContext, bool>` can be used to map requests to a new branch of the pipeline.</span></span> <span data-ttu-id="cb31c-225">En el ejemplo siguiente se usa un predicado para detectar la presencia de una `branch` variable de cadena de consulta:</span><span class="sxs-lookup"><span data-stu-id="cb31c-225">In the following example, a predicate is used to detect the presence of a query string variable `branch`:</span></span>

[!code-csharp[](index/snapshot/Chain/StartupMapWhen.cs?highlight=14-15)]

<span data-ttu-id="cb31c-226">En la siguiente tabla se muestran las solicitudes y las respuestas de `http://localhost:1234` con el código anterior:</span><span class="sxs-lookup"><span data-stu-id="cb31c-226">The following table shows the requests and responses from `http://localhost:1234` using the previous code:</span></span>

| <span data-ttu-id="cb31c-227">Request</span><span class="sxs-lookup"><span data-stu-id="cb31c-227">Request</span></span>                       | <span data-ttu-id="cb31c-228">Respuesta</span><span class="sxs-lookup"><span data-stu-id="cb31c-228">Response</span></span>                     |
| ----------------------------- | ---------------------------- |
| <span data-ttu-id="cb31c-229">localhost:1234</span><span class="sxs-lookup"><span data-stu-id="cb31c-229">localhost:1234</span></span>                | <span data-ttu-id="cb31c-230">Saludos del delegado sin Map.</span><span class="sxs-lookup"><span data-stu-id="cb31c-230">Hello from non-Map delegate.</span></span> |
| <span data-ttu-id="cb31c-231">localhost:1234/?branch=master</span><span class="sxs-lookup"><span data-stu-id="cb31c-231">localhost:1234/?branch=master</span></span> | <span data-ttu-id="cb31c-232">Rama usada = master</span><span class="sxs-lookup"><span data-stu-id="cb31c-232">Branch used = master</span></span>         |

<span data-ttu-id="cb31c-233"><xref:Microsoft.AspNetCore.Builder.UseWhenExtensions.UseWhen*> también crea una rama de la canalización de solicitudes según el resultado del predicado proporcionado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-233"><xref:Microsoft.AspNetCore.Builder.UseWhenExtensions.UseWhen*> also branches the request pipeline based on the result of the given predicate.</span></span> <span data-ttu-id="cb31c-234">A diferencia de lo que sucede con `MapWhen`, esta rama se vuelve a unir a la canalización principal si no realiza un cortocircuito ni contiene un middleware de terminal:</span><span class="sxs-lookup"><span data-stu-id="cb31c-234">Unlike with `MapWhen`, this branch is rejoined to the main pipeline if it doesn't short-circuit or contain a terminal middleware:</span></span>

[!code-csharp[](index/snapshot/Chain/StartupUseWhen.cs?highlight=25-26)]

<span data-ttu-id="cb31c-235">En el ejemplo anterior, la respuesta "Hola desde la canalización principal."</span><span class="sxs-lookup"><span data-stu-id="cb31c-235">In the preceding example, a response of "Hello from main pipeline."</span></span> <span data-ttu-id="cb31c-236">se escribe para todas las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-236">is written for all requests.</span></span> <span data-ttu-id="cb31c-237">Si la solicitud incluye una variable de cadena de consulta `branch`, su valor se registra antes de que se vuelva a unir la canalización principal.</span><span class="sxs-lookup"><span data-stu-id="cb31c-237">If the request includes a query string variable `branch`, its value is logged before the main pipeline is rejoined.</span></span>

## <a name="built-in-middleware"></a><span data-ttu-id="cb31c-238">Middleware integrado</span><span class="sxs-lookup"><span data-stu-id="cb31c-238">Built-in middleware</span></span>

<span data-ttu-id="cb31c-239">ASP.NET Core incluye los componentes de software intermedio siguientes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-239">ASP.NET Core ships with the following middleware components.</span></span> <span data-ttu-id="cb31c-240">En la columna *Orden* se proporcionan notas sobre la ubicación del middleware en la canalización de procesamiento de solicitudes, así como las condiciones con las que podría finalizar el procesamiento de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-240">The *Order* column provides notes on middleware placement in the request processing pipeline and under what conditions the middleware may terminate request processing.</span></span> <span data-ttu-id="cb31c-241">Cuando un middleware cortocircuita la canalización de procesamiento de solicitudes e impide el procesamiento de una solicitud por parte de middleware descendente adicional, se llama *middleware de terminal*.</span><span class="sxs-lookup"><span data-stu-id="cb31c-241">When a middleware short-circuits the request processing pipeline and prevents further downstream middleware from processing a request, it's called a *terminal middleware*.</span></span> <span data-ttu-id="cb31c-242">Para más información sobre cómo cortocircuitar, consulte la sección [Creación de una canalización de middleware con IApplicationBuilder](#create-a-middleware-pipeline-with-iapplicationbuilder).</span><span class="sxs-lookup"><span data-stu-id="cb31c-242">For more information on short-circuiting, see the [Create a middleware pipeline with IApplicationBuilder](#create-a-middleware-pipeline-with-iapplicationbuilder) section.</span></span>

| <span data-ttu-id="cb31c-243">Software intermedio</span><span class="sxs-lookup"><span data-stu-id="cb31c-243">Middleware</span></span> | <span data-ttu-id="cb31c-244">Descripción</span><span class="sxs-lookup"><span data-stu-id="cb31c-244">Description</span></span> | <span data-ttu-id="cb31c-245">Ordenar</span><span class="sxs-lookup"><span data-stu-id="cb31c-245">Order</span></span> |
| ---------- | ----------- | ----- |
| [<span data-ttu-id="cb31c-246">Autenticación</span><span class="sxs-lookup"><span data-stu-id="cb31c-246">Authentication</span></span>](xref:security/authentication/identity) | <span data-ttu-id="cb31c-247">Proporciona compatibilidad con autenticación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-247">Provides authentication support.</span></span> | <span data-ttu-id="cb31c-248">Antes de que se necesite `HttpContext.User`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-248">Before `HttpContext.User` is needed.</span></span> <span data-ttu-id="cb31c-249">Terminal para devoluciones de llamadas OAuth.</span><span class="sxs-lookup"><span data-stu-id="cb31c-249">Terminal for OAuth callbacks.</span></span> |
| [<span data-ttu-id="cb31c-250">Autorización</span><span class="sxs-lookup"><span data-stu-id="cb31c-250">Authorization</span></span>](xref:Microsoft.AspNetCore.Builder.AuthorizationAppBuilderExtensions.UseAuthorization*) | <span data-ttu-id="cb31c-251">Proporciona compatibilidad con la autorización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-251">Provides authorization support.</span></span> | <span data-ttu-id="cb31c-252">Inmediatamente después del middleware de autenticación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-252">Immediately after the Authentication Middleware.</span></span> |
| [<span data-ttu-id="cb31c-253">Directiva de cookies</span><span class="sxs-lookup"><span data-stu-id="cb31c-253">Cookie Policy</span></span>](xref:security/gdpr) | <span data-ttu-id="cb31c-254">Realiza un seguimiento del consentimiento de los usuarios para almacenar información personal y aplica los estándares mínimos para los campos de las cookies, como `secure` y `SameSite`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-254">Tracks consent from users for storing personal information and enforces minimum standards for cookie fields, such as `secure` and `SameSite`.</span></span> | <span data-ttu-id="cb31c-255">Antes del middleware que emite las cookies.</span><span class="sxs-lookup"><span data-stu-id="cb31c-255">Before middleware that issues cookies.</span></span> <span data-ttu-id="cb31c-256">Ejemplos: autenticación, sesión y MVC (TempData).</span><span class="sxs-lookup"><span data-stu-id="cb31c-256">Examples: Authentication, Session, MVC (TempData).</span></span> |
| [<span data-ttu-id="cb31c-257">CORS</span><span class="sxs-lookup"><span data-stu-id="cb31c-257">CORS</span></span>](xref:security/cors) | <span data-ttu-id="cb31c-258">Configura el uso compartido de recursos entre orígenes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-258">Configures Cross-Origin Resource Sharing.</span></span> | <span data-ttu-id="cb31c-259">Antes de los componentes que usan CORS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-259">Before components that use CORS.</span></span> <span data-ttu-id="cb31c-260">`UseCors` actualmente debe ir antes de `UseResponseCaching` debido a [este error](https://github.com/dotnet/aspnetcore/issues/23218).</span><span class="sxs-lookup"><span data-stu-id="cb31c-260">`UseCors` currently must go before `UseResponseCaching` due to [this bug](https://github.com/dotnet/aspnetcore/issues/23218).</span></span>|
| [<span data-ttu-id="cb31c-261">Diagnóstico</span><span class="sxs-lookup"><span data-stu-id="cb31c-261">Diagnostics</span></span>](xref:fundamentals/error-handling) | <span data-ttu-id="cb31c-262">Varios middleware independientes que proporcionan una página de excepciones para el desarrollador, control de excepciones, páginas de códigos de estado y la página web predeterminada para las nuevas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="cb31c-262">Several separate middlewares that provide a developer exception page, exception handling, status code pages, and the default web page for new apps.</span></span> | <span data-ttu-id="cb31c-263">Antes de los componentes que generan errores.</span><span class="sxs-lookup"><span data-stu-id="cb31c-263">Before components that generate errors.</span></span> <span data-ttu-id="cb31c-264">Terminal para excepciones o con el fin de proporcionar la página web predeterminada para las nuevas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="cb31c-264">Terminal for exceptions or serving the default web page for new apps.</span></span> |
| [<span data-ttu-id="cb31c-265">Encabezados reenviados</span><span class="sxs-lookup"><span data-stu-id="cb31c-265">Forwarded Headers</span></span>](xref:host-and-deploy/proxy-load-balancer) | <span data-ttu-id="cb31c-266">Reenvía encabezados con proxy a la solicitud actual.</span><span class="sxs-lookup"><span data-stu-id="cb31c-266">Forwards proxied headers onto the current request.</span></span> | <span data-ttu-id="cb31c-267">Antes de los componentes que consumen los campos actualizados.</span><span class="sxs-lookup"><span data-stu-id="cb31c-267">Before components that consume the updated fields.</span></span> <span data-ttu-id="cb31c-268">Ejemplos: esquema, host, IP de cliente y método.</span><span class="sxs-lookup"><span data-stu-id="cb31c-268">Examples: scheme, host, client IP, method.</span></span> |
| [<span data-ttu-id="cb31c-269">Comprobación de estado</span><span class="sxs-lookup"><span data-stu-id="cb31c-269">Health Check</span></span>](xref:host-and-deploy/health-checks) | <span data-ttu-id="cb31c-270">Comprueba el estado de una aplicación ASP.NET Core y sus dependencias, como la comprobación de disponibilidad de base de datos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-270">Checks the health of an ASP.NET Core app and its dependencies, such as checking database availability.</span></span> | <span data-ttu-id="cb31c-271">Terminal si una solicitud coincide con un punto de conexión de comprobación de estado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-271">Terminal if a request matches a health check endpoint.</span></span> |
| [<span data-ttu-id="cb31c-272">Propagación de encabezados</span><span class="sxs-lookup"><span data-stu-id="cb31c-272">Header Propagation</span></span>](xref:fundamentals/http-requests#header-propagation-middleware) | <span data-ttu-id="cb31c-273">Permite propagar los encabezados HTTP de la solicitud entrante a las solicitudes del cliente HTTP salientes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-273">Propagates HTTP headers from the incoming request to the outgoing HTTP Client requests.</span></span> |
| [<span data-ttu-id="cb31c-274">Invalidación del método HTTP</span><span class="sxs-lookup"><span data-stu-id="cb31c-274">HTTP Method Override</span></span>](xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions) | <span data-ttu-id="cb31c-275">Permite que una solicitud POST entrante invalide el método.</span><span class="sxs-lookup"><span data-stu-id="cb31c-275">Allows an incoming POST request to override the method.</span></span> | <span data-ttu-id="cb31c-276">Antes de los componentes que consumen el método actualizado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-276">Before components that consume the updated method.</span></span> |
| [<span data-ttu-id="cb31c-277">Redireccionamiento de HTTPS</span><span class="sxs-lookup"><span data-stu-id="cb31c-277">HTTPS Redirection</span></span>](xref:security/enforcing-ssl#require-https) | <span data-ttu-id="cb31c-278">Redirija todas las solicitudes HTTP a HTTPS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-278">Redirect all HTTP requests to HTTPS.</span></span> | <span data-ttu-id="cb31c-279">Antes de los componentes que consumen la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="cb31c-279">Before components that consume the URL.</span></span> |
| [<span data-ttu-id="cb31c-280">Seguridad de transporte estricta de HTTP (HSTS)</span><span class="sxs-lookup"><span data-stu-id="cb31c-280">HTTP Strict Transport Security (HSTS)</span></span>](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) | <span data-ttu-id="cb31c-281">Middleware de mejora de seguridad que agrega un encabezado de respuesta especial.</span><span class="sxs-lookup"><span data-stu-id="cb31c-281">Security enhancement middleware that adds a special response header.</span></span> | <span data-ttu-id="cb31c-282">Antes de que se envíen las respuestas y después de los componentes que modifican las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-282">Before responses are sent and after components that modify requests.</span></span> <span data-ttu-id="cb31c-283">Ejemplos: encabezados reenviados y reescritura de URL.</span><span class="sxs-lookup"><span data-stu-id="cb31c-283">Examples: Forwarded Headers, URL Rewriting.</span></span> |
| [<span data-ttu-id="cb31c-284">MVC</span><span class="sxs-lookup"><span data-stu-id="cb31c-284">MVC</span></span>](xref:mvc/overview) | <span data-ttu-id="cb31c-285">Procesa las solicitudes con MVC/Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="cb31c-285">Processes requests with MVC/Razor Pages.</span></span> | <span data-ttu-id="cb31c-286">Si hay una solicitud que coincida con una ruta, será final.</span><span class="sxs-lookup"><span data-stu-id="cb31c-286">Terminal if a request matches a route.</span></span> |
| [<span data-ttu-id="cb31c-287">OWIN</span><span class="sxs-lookup"><span data-stu-id="cb31c-287">OWIN</span></span>](xref:fundamentals/owin) | <span data-ttu-id="cb31c-288">Puede interoperar con aplicaciones, servidores y software intermedio basados en OWIN.</span><span class="sxs-lookup"><span data-stu-id="cb31c-288">Interop with OWIN-based apps, servers, and middleware.</span></span> | <span data-ttu-id="cb31c-289">Si el software intermedio de OWIN procesa completamente la solicitud, será final.</span><span class="sxs-lookup"><span data-stu-id="cb31c-289">Terminal if the OWIN Middleware fully processes the request.</span></span> |
| [<span data-ttu-id="cb31c-290">Almacenamiento en caché de respuestas</span><span class="sxs-lookup"><span data-stu-id="cb31c-290">Response Caching</span></span>](xref:performance/caching/middleware) | <span data-ttu-id="cb31c-291">Proporciona compatibilidad con la captura de respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-291">Provides support for caching responses.</span></span> | <span data-ttu-id="cb31c-292">Antes de los componentes que requieren el almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="cb31c-292">Before components that require caching.</span></span> <span data-ttu-id="cb31c-293">`UseCORS` debe ser anterior a `UseResponseCaching`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-293">`UseCORS` must come before `UseResponseCaching`.</span></span>|
| [<span data-ttu-id="cb31c-294">Compresión de respuesta</span><span class="sxs-lookup"><span data-stu-id="cb31c-294">Response Compression</span></span>](xref:performance/response-compression) | <span data-ttu-id="cb31c-295">Proporciona compatibilidad con la compresión de respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-295">Provides support for compressing responses.</span></span> | <span data-ttu-id="cb31c-296">Antes de los componentes que requieren compresión.</span><span class="sxs-lookup"><span data-stu-id="cb31c-296">Before components that require compression.</span></span> |
| [<span data-ttu-id="cb31c-297">Localización de solicitudes</span><span class="sxs-lookup"><span data-stu-id="cb31c-297">Request Localization</span></span>](xref:fundamentals/localization) | <span data-ttu-id="cb31c-298">Proporciona compatibilidad con ubicación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-298">Provides localization support.</span></span> | <span data-ttu-id="cb31c-299">Antes de los componentes que dependen de la ubicación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-299">Before localization sensitive components.</span></span> |
| [<span data-ttu-id="cb31c-300">Enrutamiento de punto de conexión</span><span class="sxs-lookup"><span data-stu-id="cb31c-300">Endpoint Routing</span></span>](xref:fundamentals/routing) | <span data-ttu-id="cb31c-301">Define y restringe las rutas de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="cb31c-301">Defines and constrains request routes.</span></span> | <span data-ttu-id="cb31c-302">Terminal para rutas que coincidan.</span><span class="sxs-lookup"><span data-stu-id="cb31c-302">Terminal for matching routes.</span></span> |
| [<span data-ttu-id="cb31c-303">SPA</span><span class="sxs-lookup"><span data-stu-id="cb31c-303">SPA</span></span>](xref:Microsoft.AspNetCore.Builder.SpaApplicationBuilderExtensions.UseSpa*) | <span data-ttu-id="cb31c-304">Controla todas las solicitudes desde este punto de la cadena de middleware devolviendo la página predeterminada de la aplicación de página única (SPA).</span><span class="sxs-lookup"><span data-stu-id="cb31c-304">Handles all requests from this point in the middleware chain by returning the default page for the Single Page Application (SPA)</span></span> | <span data-ttu-id="cb31c-305">En un punto posterior de la cadena, de modo que otro middleware dedicado a proporcionar archivos estáticos, acciones de MVC y otros elementos tenga prioridad.</span><span class="sxs-lookup"><span data-stu-id="cb31c-305">Late in the chain, so that other middleware for serving static files, MVC actions, etc., takes precedence.</span></span>|
| [<span data-ttu-id="cb31c-306">Sesión</span><span class="sxs-lookup"><span data-stu-id="cb31c-306">Session</span></span>](xref:fundamentals/app-state) | <span data-ttu-id="cb31c-307">Proporciona compatibilidad con la administración de sesiones de usuario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-307">Provides support for managing user sessions.</span></span> | <span data-ttu-id="cb31c-308">Antes de los componentes que requieren Session.</span><span class="sxs-lookup"><span data-stu-id="cb31c-308">Before components that require Session.</span></span> | 
| [<span data-ttu-id="cb31c-309">Archivos estáticos</span><span class="sxs-lookup"><span data-stu-id="cb31c-309">Static Files</span></span>](xref:fundamentals/static-files) | <span data-ttu-id="cb31c-310">Proporciona compatibilidad con la proporción de archivos estáticos y la exploración de directorios.</span><span class="sxs-lookup"><span data-stu-id="cb31c-310">Provides support for serving static files and directory browsing.</span></span> | <span data-ttu-id="cb31c-311">Si hay una solicitud que coincida con un archivo, será final.</span><span class="sxs-lookup"><span data-stu-id="cb31c-311">Terminal if a request matches a file.</span></span> |
| [<span data-ttu-id="cb31c-312">Reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="cb31c-312">URL Rewrite</span></span>](xref:fundamentals/url-rewriting) | <span data-ttu-id="cb31c-313">Proporciona compatibilidad con la reescritura de direcciones URL y la redirección de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-313">Provides support for rewriting URLs and redirecting requests.</span></span> | <span data-ttu-id="cb31c-314">Antes de los componentes que consumen la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="cb31c-314">Before components that consume the URL.</span></span> |
| [<span data-ttu-id="cb31c-315">WebSockets</span><span class="sxs-lookup"><span data-stu-id="cb31c-315">WebSockets</span></span>](xref:fundamentals/websockets) | <span data-ttu-id="cb31c-316">Habilita el protocolo WebSockets.</span><span class="sxs-lookup"><span data-stu-id="cb31c-316">Enables the WebSockets protocol.</span></span> | <span data-ttu-id="cb31c-317">Antes de los componentes necesarios para aceptar solicitudes de WebSocket.</span><span class="sxs-lookup"><span data-stu-id="cb31c-317">Before components that are required to accept WebSocket requests.</span></span> |

## <a name="additional-resources"></a><span data-ttu-id="cb31c-318">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="cb31c-318">Additional resources</span></span>

* <xref:fundamentals/middleware/write>
* <xref:test/middleware>
* <xref:migration/http-modules>
* <xref:fundamentals/startup>
* <xref:fundamentals/request-features>
* <xref:fundamentals/middleware/extensibility>
* <xref:fundamentals/middleware/extensibility-third-party-container>

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="cb31c-319">Por [Rick Anderson](https://twitter.com/RickAndMSFT) y [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="cb31c-319">By [Rick Anderson](https://twitter.com/RickAndMSFT) and [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="cb31c-320">El software intermedio es un software que se ensambla en una canalización de una aplicación para controlar las solicitudes y las respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-320">Middleware is software that's assembled into an app pipeline to handle requests and responses.</span></span> <span data-ttu-id="cb31c-321">Cada componente puede hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="cb31c-321">Each component:</span></span>

* <span data-ttu-id="cb31c-322">Elegir si se pasa la solicitud al siguiente componente de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-322">Chooses whether to pass the request to the next component in the pipeline.</span></span>
* <span data-ttu-id="cb31c-323">Realizar trabajos antes y después del siguiente componente de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-323">Can perform work before and after the next component in the pipeline.</span></span>

<span data-ttu-id="cb31c-324">Los delegados de solicitudes se usan para crear la canalización de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-324">Request delegates are used to build the request pipeline.</span></span> <span data-ttu-id="cb31c-325">Estos también controlan las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="cb31c-325">The request delegates handle each HTTP request.</span></span>

<span data-ttu-id="cb31c-326">Los delegados de solicitudes se configuran con los métodos de extensión <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*>, <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*> y <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-326">Request delegates are configured using <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*>, <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*>, and <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*> extension methods.</span></span> <span data-ttu-id="cb31c-327">Un delegado de solicitudes se puede especificar en línea como un método anónimo (denominado middleware en línea) o se puede definir en una clase reutilizable.</span><span class="sxs-lookup"><span data-stu-id="cb31c-327">An individual request delegate can be specified in-line as an anonymous method (called in-line middleware), or it can be defined in a reusable class.</span></span> <span data-ttu-id="cb31c-328">Estas clases reutilizables y métodos anónimos en línea se conocen como *software intermedio* o *componentes de software intermedio*.</span><span class="sxs-lookup"><span data-stu-id="cb31c-328">These reusable classes and in-line anonymous methods are *middleware*, also called *middleware components*.</span></span> <span data-ttu-id="cb31c-329">Cada componente de software intermedio de la canalización de solicitudes es responsable de invocar el siguiente componente de la canalización o de cortocircuitar la canalización, en caso de ser necesario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-329">Each middleware component in the request pipeline is responsible for invoking the next component in the pipeline or short-circuiting the pipeline.</span></span> <span data-ttu-id="cb31c-330">Cuando un middleware se cortocircuita, se llama *middleware de terminal* porque impide el procesamiento de la solicitud por parte de middleware adicional.</span><span class="sxs-lookup"><span data-stu-id="cb31c-330">When a middleware short-circuits, it's called a *terminal middleware* because it prevents further middleware from processing the request.</span></span>

<span data-ttu-id="cb31c-331">En <xref:migration/http-modules> se explica la diferencia entre las canalizaciones de solicitudes en ASP.NET Core y ASP.NET 4.x y se proporcionan ejemplos adicionales de middleware.</span><span class="sxs-lookup"><span data-stu-id="cb31c-331"><xref:migration/http-modules> explains the difference between request pipelines in ASP.NET Core and ASP.NET 4.x and provides additional middleware samples.</span></span>

## <a name="create-a-middleware-pipeline-with-iapplicationbuilder"></a><span data-ttu-id="cb31c-332">Creación de una canalización de software intermedio con IApplicationBuilder</span><span class="sxs-lookup"><span data-stu-id="cb31c-332">Create a middleware pipeline with IApplicationBuilder</span></span>

<span data-ttu-id="cb31c-333">La canalización de solicitudes de ASP.NET Core consiste en una secuencia de delegados de solicitud a los que se llama de uno en uno.</span><span class="sxs-lookup"><span data-stu-id="cb31c-333">The ASP.NET Core request pipeline consists of a sequence of request delegates, called one after the other.</span></span> <span data-ttu-id="cb31c-334">En el siguiente diagrama se muestra este concepto.</span><span class="sxs-lookup"><span data-stu-id="cb31c-334">The following diagram demonstrates the concept.</span></span> <span data-ttu-id="cb31c-335">El subproceso de ejecución sigue las flechas negras.</span><span class="sxs-lookup"><span data-stu-id="cb31c-335">The thread of execution follows the black arrows.</span></span>

![En el patrón de procesamiento de solicitudes se muestra una solicitud entrante, el procesamiento a través de tres softwares intermedios y la respuesta saliente de la aplicación.](index/_static/request-delegate-pipeline.png)

<span data-ttu-id="cb31c-339">Cada delegado puede realizar operaciones antes y después del siguiente.</span><span class="sxs-lookup"><span data-stu-id="cb31c-339">Each delegate can perform operations before and after the next delegate.</span></span> <span data-ttu-id="cb31c-340">Los delegados que controlan excepciones deben llamarse al principio de la canalización para que puedan capturar las excepciones que se producen en las fases siguientes de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-340">Exception-handling delegates should be called early in the pipeline, so they can catch exceptions that occur in later stages of the pipeline.</span></span>

<span data-ttu-id="cb31c-341">La aplicación ASP.NET Core más sencilla posible configura un solo delegado de solicitudes que controla todas las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-341">The simplest possible ASP.NET Core app sets up a single request delegate that handles all requests.</span></span> <span data-ttu-id="cb31c-342">En este caso no se incluye una canalización de solicitudes real.</span><span class="sxs-lookup"><span data-stu-id="cb31c-342">This case doesn't include an actual request pipeline.</span></span> <span data-ttu-id="cb31c-343">En su lugar, solo se llama a una única función anónima en respuesta a todas las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="cb31c-343">Instead, a single anonymous function is called in response to every HTTP request.</span></span>

[!code-csharp[](index/snapshot/Middleware/Startup.cs)]

<span data-ttu-id="cb31c-344">El primer delegado de <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*> finaliza la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-344">The first <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*> delegate terminates the pipeline.</span></span>

<span data-ttu-id="cb31c-345">Encadene varios delegados de solicitudes con <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-345">Chain multiple request delegates together with <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>.</span></span> <span data-ttu-id="cb31c-346">El parámetro `next` representa el siguiente delegado de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-346">The `next` parameter represents the next delegate in the pipeline.</span></span> <span data-ttu-id="cb31c-347">Si *no* llama al *siguiente* parámetro, puede cortocircuitar la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-347">You can short-circuit the pipeline by *not* calling the *next* parameter.</span></span> <span data-ttu-id="cb31c-348">Normalmente, puede realizar acciones antes y después del siguiente delegado, tal como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="cb31c-348">You can typically perform actions both before and after the next delegate, as the following example demonstrates:</span></span>

[!code-csharp[](index/snapshot/Chain/Startup.cs)]

<span data-ttu-id="cb31c-349">Cuando un delegado no pasa una solicitud al siguiente delegado, se denomina *cortocircuitar la canalización de solicitudes*.</span><span class="sxs-lookup"><span data-stu-id="cb31c-349">When a delegate doesn't pass a request to the next delegate, it's called *short-circuiting the request pipeline*.</span></span> <span data-ttu-id="cb31c-350">Este proceso es necesario muchas veces, ya que previene la realización de trabajo innecesario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-350">Short-circuiting is often desirable because it avoids unnecessary work.</span></span> <span data-ttu-id="cb31c-351">Por ejemplo, el [middleware de archivos estáticos](xref:fundamentals/static-files) puede actuar como *middleware de terminal* procesando una solicitud para un archivo estático y cortocircuitando el resto de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-351">For example, [Static File Middleware](xref:fundamentals/static-files) can act as a *terminal middleware* by processing a request for a static file and short-circuiting the rest of the pipeline.</span></span> <span data-ttu-id="cb31c-352">El middleware agregado a la canalización antes del middleware que finaliza el procesamiento sigue procesando código después de sus instrucciones `next.Invoke`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-352">Middleware added to the pipeline before the middleware that terminates further processing still processes code after their `next.Invoke` statements.</span></span> <span data-ttu-id="cb31c-353">Sin embargo, consulte la siguiente advertencia sobre intentar escribir en una respuesta que ya se ha enviado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-353">However, see the following warning about attempting to write to a response that has already been sent.</span></span>

> [!WARNING]
> <span data-ttu-id="cb31c-354">No llame a `next.Invoke` después de haber enviado la respuesta al cliente.</span><span class="sxs-lookup"><span data-stu-id="cb31c-354">Don't call `next.Invoke` after the response has been sent to the client.</span></span> <span data-ttu-id="cb31c-355">Si se modifica <xref:Microsoft.AspNetCore.Http.HttpResponse> después de haber iniciado la respuesta, se producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="cb31c-355">Changes to <xref:Microsoft.AspNetCore.Http.HttpResponse> after the response has started throw an exception.</span></span> <span data-ttu-id="cb31c-356">Por ejemplo, se producirá una excepción al realizar cambios tales como el establecimiento de encabezados o el código.</span><span class="sxs-lookup"><span data-stu-id="cb31c-356">For example, changes such as setting headers and a status code throw an exception.</span></span> <span data-ttu-id="cb31c-357">Si escribe en el cuerpo de la respuesta después de llamar a `next`:</span><span class="sxs-lookup"><span data-stu-id="cb31c-357">Writing to the response body after calling `next`:</span></span>
>
> * <span data-ttu-id="cb31c-358">Puede provocar una infracción del protocolo.</span><span class="sxs-lookup"><span data-stu-id="cb31c-358">May cause a protocol violation.</span></span> <span data-ttu-id="cb31c-359">Por ejemplo, si escribe más de la longitud `Content-Length` establecida.</span><span class="sxs-lookup"><span data-stu-id="cb31c-359">For example, writing more than the stated `Content-Length`.</span></span>
> * <span data-ttu-id="cb31c-360">Puede dañar el formato del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="cb31c-360">May corrupt the body format.</span></span> <span data-ttu-id="cb31c-361">Por ejemplo, si escribe un pie de página en HTML en un archivo CSS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-361">For example, writing an HTML footer to a CSS file.</span></span>
>
> <span data-ttu-id="cb31c-362"><xref:Microsoft.AspNetCore.Http.HttpResponse.HasStarted*> es una sugerencia útil para indicar si se han enviado los encabezados o se han realizado escrituras en el cuerpo.</span><span class="sxs-lookup"><span data-stu-id="cb31c-362"><xref:Microsoft.AspNetCore.Http.HttpResponse.HasStarted*> is a useful hint to indicate if headers have been sent or the body has been written to.</span></span>

<a name="order"></a>

## <a name="middleware-order"></a><span data-ttu-id="cb31c-363">Orden del middleware</span><span class="sxs-lookup"><span data-stu-id="cb31c-363">Middleware order</span></span>

<span data-ttu-id="cb31c-364">El orden en el que se agregan los componentes de software intermedio en el método `Startup.Configure` define el orden en el que se invocarán los componentes de software intermedio en las solicitudes y el orden inverso de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="cb31c-364">The order that middleware components are added in the `Startup.Configure` method defines the order in which the middleware components are invoked on requests and the reverse order for the response.</span></span> <span data-ttu-id="cb31c-365">Por motivos de seguridad, rendimiento y funcionalidad, el orden es **crítico**.</span><span class="sxs-lookup"><span data-stu-id="cb31c-365">The order is **critical** for security, performance, and functionality.</span></span>

<span data-ttu-id="cb31c-366">El método `Startup.Configure` siguiente agrega componentes de middleware relacionados con la seguridad en el orden recomendado:</span><span class="sxs-lookup"><span data-stu-id="cb31c-366">The following `Startup.Configure` method adds security related middleware components in the recommended order:</span></span>

[!code-csharp[](index/snapshot/Startup22.cs?name=snippet)]

<span data-ttu-id="cb31c-367">En el código anterior:</span><span class="sxs-lookup"><span data-stu-id="cb31c-367">In the preceding code:</span></span>

* <span data-ttu-id="cb31c-368">El middleware que no se agrega al crear una aplicación web con [cuentas de usuario individuales](xref:security/authentication/identity) se convierte en comentario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-368">Middleware that is not added when creating a new web app with [individual users accounts](xref:security/authentication/identity) is commented out.</span></span>
* <span data-ttu-id="cb31c-369">No todo el middleware tiene que ir en este orden exacto, pero gran parte sí lo hace.</span><span class="sxs-lookup"><span data-stu-id="cb31c-369">Not every middleware needs to go in this exact order, but many do.</span></span> <span data-ttu-id="cb31c-370">Por ejemplo, `UseCors` y `UseAuthentication` deben ir en el orden mostrado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-370">For example, `UseCors` and `UseAuthentication` must go in the order shown.</span></span>

<span data-ttu-id="cb31c-371">El siguiente método `Startup.Configure` agrega los componentes de middleware para escenarios de aplicaciones comunes:</span><span class="sxs-lookup"><span data-stu-id="cb31c-371">The following `Startup.Configure` method adds middleware components for common app scenarios:</span></span>

1. <span data-ttu-id="cb31c-372">Control de errores y excepciones</span><span class="sxs-lookup"><span data-stu-id="cb31c-372">Exception/error handling</span></span>
   * <span data-ttu-id="cb31c-373">Cuando la aplicación se ejecuta en el entorno de desarrollo:</span><span class="sxs-lookup"><span data-stu-id="cb31c-373">When the app runs in the Development environment:</span></span>
     * <span data-ttu-id="cb31c-374">El middleware de la página de excepciones para el desarrollador (<xref:Microsoft.AspNetCore.Builder.DeveloperExceptionPageExtensions.UseDeveloperExceptionPage*>) informa los errores en tiempo de ejecución de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-374">Developer Exception Page Middleware (<xref:Microsoft.AspNetCore.Builder.DeveloperExceptionPageExtensions.UseDeveloperExceptionPage*>) reports app runtime errors.</span></span>
     * <span data-ttu-id="cb31c-375">El middleware de la página de errores de la base de datos (`Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage`) informa los errores en tiempo de ejecución de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-375">Database Error Page Middleware (`Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage`) reports database runtime errors.</span></span>
   * <span data-ttu-id="cb31c-376">Cuando la aplicación se ejecuta en el entorno de producción:</span><span class="sxs-lookup"><span data-stu-id="cb31c-376">When the app runs in the Production environment:</span></span>
     * <span data-ttu-id="cb31c-377">El middleware del controlador de excepciones (<xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*>) detecta las excepciones generadas en los middlewares siguientes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-377">Exception Handler Middleware (<xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*>) catches exceptions thrown in the following middlewares.</span></span>
     * <span data-ttu-id="cb31c-378">El middleware del protocolo de seguridad de transporte estricta de HTTP (HSTS) (<xref:Microsoft.AspNetCore.Builder.HstsBuilderExtensions.UseHsts*>) agrega el encabezado `Strict-Transport-Security`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-378">HTTP Strict Transport Security Protocol (HSTS) Middleware (<xref:Microsoft.AspNetCore.Builder.HstsBuilderExtensions.UseHsts*>) adds the `Strict-Transport-Security` header.</span></span>
1. <span data-ttu-id="cb31c-379">El middleware de redireccionamiento de HTTPS (<xref:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection*>) redirige las solicitudes HTTP a HTTPS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-379">HTTPS Redirection Middleware (<xref:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection*>) redirects HTTP requests to HTTPS.</span></span>
1. <span data-ttu-id="cb31c-380">El middleware de archivos estáticos (<xref:Microsoft.AspNetCore.Builder.StaticFileExtensions.UseStaticFiles*>) devuelve archivos estáticos y genera un cortocircuito más allá del procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="cb31c-380">Static File Middleware (<xref:Microsoft.AspNetCore.Builder.StaticFileExtensions.UseStaticFiles*>) returns static files and short-circuits further request processing.</span></span>
1. <span data-ttu-id="cb31c-381">El middleware de directivas de cookies (<xref:Microsoft.AspNetCore.Builder.CookiePolicyAppBuilderExtensions.UseCookiePolicy*>) permite que la aplicación cumpla con las normas del Reglamento general de protección de datos (RGPD) de la Unión Europea.</span><span class="sxs-lookup"><span data-stu-id="cb31c-381">Cookie Policy Middleware (<xref:Microsoft.AspNetCore.Builder.CookiePolicyAppBuilderExtensions.UseCookiePolicy*>) conforms the app to the EU General Data Protection Regulation (GDPR) regulations.</span></span>
1. <span data-ttu-id="cb31c-382">El middleware de autenticación (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>) intenta autenticar al usuarios antes de que se le permita acceder a los recursos protegidos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-382">Authentication Middleware (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>) attempts to authenticate the user before they're allowed access to secure resources.</span></span>
1. <span data-ttu-id="cb31c-383">El middleware de sesiones (<xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession*>) establece y mantiene el estado de sesión.</span><span class="sxs-lookup"><span data-stu-id="cb31c-383">Session Middleware (<xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession*>) establishes and maintains session state.</span></span> <span data-ttu-id="cb31c-384">Si la aplicación usa el estado de sesión, llame al middleware de sesiones después del middleware de directivas de cookies y antes del middleware de MVC.</span><span class="sxs-lookup"><span data-stu-id="cb31c-384">If the app uses session state, call Session Middleware after Cookie Policy Middleware and before MVC Middleware.</span></span>
1. <span data-ttu-id="cb31c-385">MVC (<xref:Microsoft.AspNetCore.Builder.MvcApplicationBuilderExtensions.UseMvc*>) para agregar MVC a la canalización de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="cb31c-385">MVC (<xref:Microsoft.AspNetCore.Builder.MvcApplicationBuilderExtensions.UseMvc*>) to add MVC to the request pipeline.</span></span>

```csharp
public void Configure(IApplicationBuilder app, IHostingEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
        app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }

    app.UseHttpsRedirection();
    app.UseStaticFiles();
    app.UseCookiePolicy();
    app.UseAuthentication();
    app.UseSession();
    app.UseMvc();
}
```

<span data-ttu-id="cb31c-386">En el código de ejemplo anterior, cada método de extensión de software intermedio se expone en <xref:Microsoft.AspNetCore.Builder.IApplicationBuilder> a través del espacio de nombres de <xref:Microsoft.AspNetCore.Builder?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-386">In the preceding example code, each middleware extension method is exposed on <xref:Microsoft.AspNetCore.Builder.IApplicationBuilder> through the <xref:Microsoft.AspNetCore.Builder?displayProperty=fullName> namespace.</span></span>

<span data-ttu-id="cb31c-387"><xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*> es el primer componente de software intermedio que se agrega a la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-387"><xref:Microsoft.AspNetCore.Builder.ExceptionHandlerExtensions.UseExceptionHandler*> is the first middleware component added to the pipeline.</span></span> <span data-ttu-id="cb31c-388">Por lo tanto, el software intermedio del controlador de excepciones detectará las excepciones que se produzcan en las llamadas posteriores.</span><span class="sxs-lookup"><span data-stu-id="cb31c-388">Therefore, the Exception Handler Middleware catches any exceptions that occur in later calls.</span></span>

<span data-ttu-id="cb31c-389">El software intermedio de archivos estáticos se llama al principio de la canalización para que pueda controlar solicitudes y realizar cortocircuitos sin pasar por los componentes restantes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-389">Static File Middleware is called early in the pipeline so that it can handle requests and short-circuit without going through the remaining components.</span></span> <span data-ttu-id="cb31c-390">Este middleware **no** proporciona comprobaciones de autorización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-390">The Static File Middleware provides **no** authorization checks.</span></span> <span data-ttu-id="cb31c-391">Los archivos que proporciona el middleware de archivos estáticos, incluidos los de *wwwroot*, están disponibles de forma pública.</span><span class="sxs-lookup"><span data-stu-id="cb31c-391">Any files served by Static File Middleware, including those under *wwwroot*, are publicly available.</span></span> <span data-ttu-id="cb31c-392">Para obtener más información sobre cómo proteger este tipo de archivos, vea <xref:fundamentals/static-files>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-392">For an approach to secure static files, see <xref:fundamentals/static-files>.</span></span>

<span data-ttu-id="cb31c-393">Si el software intermedio de archivos estáticos no controla la solicitud, se pasará al software intermedio de autenticación (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>), que realizará la autenticación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-393">If the request isn't handled by the Static File Middleware, it's passed on to the Authentication Middleware (<xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*>), which performs authentication.</span></span> <span data-ttu-id="cb31c-394">Este software intermedio no cortocircuita las solicitudes sin autenticación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-394">Authentication doesn't short-circuit unauthenticated requests.</span></span> <span data-ttu-id="cb31c-395">Aunque autentique solicitudes, la autorización (y también el rechazo) se producirán después de que MVC seleccione una página de Razor o un control y una acción de MVC concretos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-395">Although Authentication Middleware authenticates requests, authorization (and rejection) occurs only after MVC selects a specific Razor Page or MVC controller and action.</span></span>

<span data-ttu-id="cb31c-396">En el ejemplo siguiente se muestra un orden de software intermedio en el que el software intermedio de archivos estáticos controla las solicitudes de archivos estáticos antes del software intermedio de compresión de respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-396">The following example demonstrates a middleware order where requests for static files are handled by Static File Middleware before Response Compression Middleware.</span></span> <span data-ttu-id="cb31c-397">Los archivos estáticos no se comprimen en este orden de software intermedio.</span><span class="sxs-lookup"><span data-stu-id="cb31c-397">Static files aren't compressed with this middleware order.</span></span> <span data-ttu-id="cb31c-398">Las respuestas de MVC de <xref:Microsoft.AspNetCore.Builder.MvcApplicationBuilderExtensions.UseMvcWithDefaultRoute*> se pueden comprimir.</span><span class="sxs-lookup"><span data-stu-id="cb31c-398">The MVC responses from <xref:Microsoft.AspNetCore.Builder.MvcApplicationBuilderExtensions.UseMvcWithDefaultRoute*> can be compressed.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    // Static files aren't compressed by Static File Middleware.
    app.UseStaticFiles();

    app.UseResponseCompression();

    app.UseMvcWithDefaultRoute();
}
```

## <a name="use-run-and-map"></a><span data-ttu-id="cb31c-399">Use, Run y Map</span><span class="sxs-lookup"><span data-stu-id="cb31c-399">Use, Run, and Map</span></span>

<span data-ttu-id="cb31c-400">Puede configurar la canalización HTTP con <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>, <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*> y <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*>.</span><span class="sxs-lookup"><span data-stu-id="cb31c-400">Configure the HTTP pipeline using <xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*>, <xref:Microsoft.AspNetCore.Builder.RunExtensions.Run*>, and <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*>.</span></span> <span data-ttu-id="cb31c-401">El método `Use` puede cortocircuitar la canalización (solo si no llama a un delegado de solicitudes `next`).</span><span class="sxs-lookup"><span data-stu-id="cb31c-401">The `Use` method can short-circuit the pipeline (that is, if it doesn't call a `next` request delegate).</span></span> <span data-ttu-id="cb31c-402">`Run` es una convención y es posible que algunos componentes de middleware expongan métodos `Run[Middleware]` que se ejecutan al final de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-402">`Run` is a convention, and some middleware components may expose `Run[Middleware]` methods that run at the end of the pipeline.</span></span>

<span data-ttu-id="cb31c-403">Las extensiones <xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*> se usan como convenciones para la creación de ramas en la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-403"><xref:Microsoft.AspNetCore.Builder.MapExtensions.Map*> extensions are used as a convention for branching the pipeline.</span></span> <span data-ttu-id="cb31c-404">`Map` crea una rama de la canalización de solicitudes según las coincidencias de la ruta de solicitud proporcionada.</span><span class="sxs-lookup"><span data-stu-id="cb31c-404">`Map` branches the request pipeline based on matches of the given request path.</span></span> <span data-ttu-id="cb31c-405">Si la ruta de solicitud comienza con la ruta proporcionada, se ejecuta la creación de la rama.</span><span class="sxs-lookup"><span data-stu-id="cb31c-405">If the request path starts with the given path, the branch is executed.</span></span>

[!code-csharp[](index/snapshot/Chain/StartupMap.cs)]

<span data-ttu-id="cb31c-406">En la siguiente tabla se muestran las solicitudes y las respuestas de `http://localhost:1234` con el código anterior.</span><span class="sxs-lookup"><span data-stu-id="cb31c-406">The following table shows the requests and responses from `http://localhost:1234` using the previous code.</span></span>

| <span data-ttu-id="cb31c-407">Request</span><span class="sxs-lookup"><span data-stu-id="cb31c-407">Request</span></span>             | <span data-ttu-id="cb31c-408">Respuesta</span><span class="sxs-lookup"><span data-stu-id="cb31c-408">Response</span></span>                     |
| ------------------- | ---------------------------- |
| <span data-ttu-id="cb31c-409">localhost:1234</span><span class="sxs-lookup"><span data-stu-id="cb31c-409">localhost:1234</span></span>      | <span data-ttu-id="cb31c-410">Saludos del delegado sin Map.</span><span class="sxs-lookup"><span data-stu-id="cb31c-410">Hello from non-Map delegate.</span></span> |
| <span data-ttu-id="cb31c-411">localhost:1234/map1</span><span class="sxs-lookup"><span data-stu-id="cb31c-411">localhost:1234/map1</span></span> | <span data-ttu-id="cb31c-412">Prueba 1 de Map</span><span class="sxs-lookup"><span data-stu-id="cb31c-412">Map Test 1</span></span>                   |
| <span data-ttu-id="cb31c-413">localhost:1234/map2</span><span class="sxs-lookup"><span data-stu-id="cb31c-413">localhost:1234/map2</span></span> | <span data-ttu-id="cb31c-414">Prueba 2 de Map</span><span class="sxs-lookup"><span data-stu-id="cb31c-414">Map Test 2</span></span>                   |
| <span data-ttu-id="cb31c-415">localhost:1234/map3</span><span class="sxs-lookup"><span data-stu-id="cb31c-415">localhost:1234/map3</span></span> | <span data-ttu-id="cb31c-416">Saludos del delegado sin Map.</span><span class="sxs-lookup"><span data-stu-id="cb31c-416">Hello from non-Map delegate.</span></span> |

<span data-ttu-id="cb31c-417">Cuando se usa `Map`, los segmentos de ruta que coincidan se eliminan de `HttpRequest.Path` y se anexan a `HttpRequest.PathBase` para cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="cb31c-417">When `Map` is used, the matched path segments are removed from `HttpRequest.Path` and appended to `HttpRequest.PathBase` for each request.</span></span>

<span data-ttu-id="cb31c-418"><xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> crea una rama de la canalización de solicitudes según el resultado del predicado proporcionado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-418"><xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> branches the request pipeline based on the result of the given predicate.</span></span> <span data-ttu-id="cb31c-419">Se puede usar cualquier predicado de tipo `Func<HttpContext, bool>` para asignar solicitudes a nuevas ramas de la canalización.</span><span class="sxs-lookup"><span data-stu-id="cb31c-419">Any predicate of type `Func<HttpContext, bool>` can be used to map requests to a new branch of the pipeline.</span></span> <span data-ttu-id="cb31c-420">En el ejemplo siguiente se usa un predicado para detectar la presencia de una `branch` variable de cadena de consulta:</span><span class="sxs-lookup"><span data-stu-id="cb31c-420">In the following example, a predicate is used to detect the presence of a query string variable `branch`:</span></span>

[!code-csharp[](index/snapshot/Chain/StartupMapWhen.cs)]

<span data-ttu-id="cb31c-421">En la siguiente tabla se muestran las solicitudes y las respuestas de `http://localhost:1234` con el código anterior.</span><span class="sxs-lookup"><span data-stu-id="cb31c-421">The following table shows the requests and responses from `http://localhost:1234` using the previous code.</span></span>

| <span data-ttu-id="cb31c-422">Request</span><span class="sxs-lookup"><span data-stu-id="cb31c-422">Request</span></span>                       | <span data-ttu-id="cb31c-423">Respuesta</span><span class="sxs-lookup"><span data-stu-id="cb31c-423">Response</span></span>                     |
| ----------------------------- | ---------------------------- |
| <span data-ttu-id="cb31c-424">localhost:1234</span><span class="sxs-lookup"><span data-stu-id="cb31c-424">localhost:1234</span></span>                | <span data-ttu-id="cb31c-425">Saludos del delegado sin Map.</span><span class="sxs-lookup"><span data-stu-id="cb31c-425">Hello from non-Map delegate.</span></span> |
| <span data-ttu-id="cb31c-426">localhost:1234/?branch=master</span><span class="sxs-lookup"><span data-stu-id="cb31c-426">localhost:1234/?branch=master</span></span> | <span data-ttu-id="cb31c-427">Rama usada = master</span><span class="sxs-lookup"><span data-stu-id="cb31c-427">Branch used = master</span></span>         |

<span data-ttu-id="cb31c-428">`Map` admite la anidación, por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="cb31c-428">`Map` supports nesting, for example:</span></span>

```csharp
app.Map("/level1", level1App => {
    level1App.Map("/level2a", level2AApp => {
        // "/level1/level2a" processing
    });
    level1App.Map("/level2b", level2BApp => {
        // "/level1/level2b" processing
    });
});
```

<span data-ttu-id="cb31c-429">`Map` puede hacer coincidir varios segmentos a la vez:</span><span class="sxs-lookup"><span data-stu-id="cb31c-429">`Map` can also match multiple segments at once:</span></span>

[!code-csharp[](index/snapshot/Chain/StartupMultiSeg.cs?highlight=13)]

## <a name="built-in-middleware"></a><span data-ttu-id="cb31c-430">Middleware integrado</span><span class="sxs-lookup"><span data-stu-id="cb31c-430">Built-in middleware</span></span>

<span data-ttu-id="cb31c-431">ASP.NET Core incluye los componentes de software intermedio siguientes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-431">ASP.NET Core ships with the following middleware components.</span></span> <span data-ttu-id="cb31c-432">En la columna *Orden* se proporcionan notas sobre la ubicación del middleware en la canalización de procesamiento de solicitudes, así como las condiciones con las que podría finalizar el procesamiento de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-432">The *Order* column provides notes on middleware placement in the request processing pipeline and under what conditions the middleware may terminate request processing.</span></span> <span data-ttu-id="cb31c-433">Cuando un middleware cortocircuita la canalización de procesamiento de solicitudes e impide el procesamiento de una solicitud por parte de middleware descendente adicional, se llama *middleware de terminal*.</span><span class="sxs-lookup"><span data-stu-id="cb31c-433">When a middleware short-circuits the request processing pipeline and prevents further downstream middleware from processing a request, it's called a *terminal middleware*.</span></span> <span data-ttu-id="cb31c-434">Para más información sobre cómo cortocircuitar, consulte la sección [Creación de una canalización de middleware con IApplicationBuilder](#create-a-middleware-pipeline-with-iapplicationbuilder).</span><span class="sxs-lookup"><span data-stu-id="cb31c-434">For more information on short-circuiting, see the [Create a middleware pipeline with IApplicationBuilder](#create-a-middleware-pipeline-with-iapplicationbuilder) section.</span></span>

| <span data-ttu-id="cb31c-435">Software intermedio</span><span class="sxs-lookup"><span data-stu-id="cb31c-435">Middleware</span></span> | <span data-ttu-id="cb31c-436">Descripción</span><span class="sxs-lookup"><span data-stu-id="cb31c-436">Description</span></span> | <span data-ttu-id="cb31c-437">Ordenar</span><span class="sxs-lookup"><span data-stu-id="cb31c-437">Order</span></span> |
| ---------- | ----------- | ----- |
| [<span data-ttu-id="cb31c-438">Autenticación</span><span class="sxs-lookup"><span data-stu-id="cb31c-438">Authentication</span></span>](xref:security/authentication/identity) | <span data-ttu-id="cb31c-439">Proporciona compatibilidad con autenticación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-439">Provides authentication support.</span></span> | <span data-ttu-id="cb31c-440">Antes de que se necesite `HttpContext.User`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-440">Before `HttpContext.User` is needed.</span></span> <span data-ttu-id="cb31c-441">Terminal para devoluciones de llamadas OAuth.</span><span class="sxs-lookup"><span data-stu-id="cb31c-441">Terminal for OAuth callbacks.</span></span> |
| [<span data-ttu-id="cb31c-442">Directiva de cookies</span><span class="sxs-lookup"><span data-stu-id="cb31c-442">Cookie Policy</span></span>](xref:security/gdpr) | <span data-ttu-id="cb31c-443">Realiza un seguimiento del consentimiento de los usuarios para almacenar información personal y aplica los estándares mínimos para los campos de las cookies, como `secure` y `SameSite`.</span><span class="sxs-lookup"><span data-stu-id="cb31c-443">Tracks consent from users for storing personal information and enforces minimum standards for cookie fields, such as `secure` and `SameSite`.</span></span> | <span data-ttu-id="cb31c-444">Antes del middleware que emite las cookies.</span><span class="sxs-lookup"><span data-stu-id="cb31c-444">Before middleware that issues cookies.</span></span> <span data-ttu-id="cb31c-445">Ejemplos: autenticación, sesión y MVC (TempData).</span><span class="sxs-lookup"><span data-stu-id="cb31c-445">Examples: Authentication, Session, MVC (TempData).</span></span> |
| [<span data-ttu-id="cb31c-446">CORS</span><span class="sxs-lookup"><span data-stu-id="cb31c-446">CORS</span></span>](xref:security/cors) | <span data-ttu-id="cb31c-447">Configura el uso compartido de recursos entre orígenes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-447">Configures Cross-Origin Resource Sharing.</span></span> | <span data-ttu-id="cb31c-448">Antes de los componentes que usan CORS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-448">Before components that use CORS.</span></span> |
| [<span data-ttu-id="cb31c-449">Diagnóstico</span><span class="sxs-lookup"><span data-stu-id="cb31c-449">Diagnostics</span></span>](xref:fundamentals/error-handling) | <span data-ttu-id="cb31c-450">Varios middleware independientes que proporcionan una página de excepciones para el desarrollador, control de excepciones, páginas de códigos de estado y la página web predeterminada para las nuevas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="cb31c-450">Several separate middlewares that provide a developer exception page, exception handling, status code pages, and the default web page for new apps.</span></span> | <span data-ttu-id="cb31c-451">Antes de los componentes que generan errores.</span><span class="sxs-lookup"><span data-stu-id="cb31c-451">Before components that generate errors.</span></span> <span data-ttu-id="cb31c-452">Terminal para excepciones o con el fin de proporcionar la página web predeterminada para las nuevas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="cb31c-452">Terminal for exceptions or serving the default web page for new apps.</span></span> |
| [<span data-ttu-id="cb31c-453">Encabezados reenviados</span><span class="sxs-lookup"><span data-stu-id="cb31c-453">Forwarded Headers</span></span>](xref:host-and-deploy/proxy-load-balancer) | <span data-ttu-id="cb31c-454">Reenvía encabezados con proxy a la solicitud actual.</span><span class="sxs-lookup"><span data-stu-id="cb31c-454">Forwards proxied headers onto the current request.</span></span> | <span data-ttu-id="cb31c-455">Antes de los componentes que consumen los campos actualizados.</span><span class="sxs-lookup"><span data-stu-id="cb31c-455">Before components that consume the updated fields.</span></span> <span data-ttu-id="cb31c-456">Ejemplos: esquema, host, IP de cliente y método.</span><span class="sxs-lookup"><span data-stu-id="cb31c-456">Examples: scheme, host, client IP, method.</span></span> |
| [<span data-ttu-id="cb31c-457">Comprobación de estado</span><span class="sxs-lookup"><span data-stu-id="cb31c-457">Health Check</span></span>](xref:host-and-deploy/health-checks) | <span data-ttu-id="cb31c-458">Comprueba el estado de una aplicación ASP.NET Core y sus dependencias, como la comprobación de disponibilidad de base de datos.</span><span class="sxs-lookup"><span data-stu-id="cb31c-458">Checks the health of an ASP.NET Core app and its dependencies, such as checking database availability.</span></span> | <span data-ttu-id="cb31c-459">Terminal si una solicitud coincide con un punto de conexión de comprobación de estado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-459">Terminal if a request matches a health check endpoint.</span></span> |
| [<span data-ttu-id="cb31c-460">Invalidación del método HTTP</span><span class="sxs-lookup"><span data-stu-id="cb31c-460">HTTP Method Override</span></span>](xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions) | <span data-ttu-id="cb31c-461">Permite que una solicitud POST entrante invalide el método.</span><span class="sxs-lookup"><span data-stu-id="cb31c-461">Allows an incoming POST request to override the method.</span></span> | <span data-ttu-id="cb31c-462">Antes de los componentes que consumen el método actualizado.</span><span class="sxs-lookup"><span data-stu-id="cb31c-462">Before components that consume the updated method.</span></span> |
| [<span data-ttu-id="cb31c-463">Redireccionamiento de HTTPS</span><span class="sxs-lookup"><span data-stu-id="cb31c-463">HTTPS Redirection</span></span>](xref:security/enforcing-ssl#require-https) | <span data-ttu-id="cb31c-464">Redirija todas las solicitudes HTTP a HTTPS.</span><span class="sxs-lookup"><span data-stu-id="cb31c-464">Redirect all HTTP requests to HTTPS.</span></span> | <span data-ttu-id="cb31c-465">Antes de los componentes que consumen la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="cb31c-465">Before components that consume the URL.</span></span> |
| [<span data-ttu-id="cb31c-466">Seguridad de transporte estricta de HTTP (HSTS)</span><span class="sxs-lookup"><span data-stu-id="cb31c-466">HTTP Strict Transport Security (HSTS)</span></span>](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) | <span data-ttu-id="cb31c-467">Middleware de mejora de seguridad que agrega un encabezado de respuesta especial.</span><span class="sxs-lookup"><span data-stu-id="cb31c-467">Security enhancement middleware that adds a special response header.</span></span> | <span data-ttu-id="cb31c-468">Antes de que se envíen las respuestas y después de los componentes que modifican las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-468">Before responses are sent and after components that modify requests.</span></span> <span data-ttu-id="cb31c-469">Ejemplos: encabezados reenviados y reescritura de URL.</span><span class="sxs-lookup"><span data-stu-id="cb31c-469">Examples: Forwarded Headers, URL Rewriting.</span></span> |
| [<span data-ttu-id="cb31c-470">MVC</span><span class="sxs-lookup"><span data-stu-id="cb31c-470">MVC</span></span>](xref:mvc/overview) | <span data-ttu-id="cb31c-471">Procesa las solicitudes con MVC/Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="cb31c-471">Processes requests with MVC/Razor Pages.</span></span> | <span data-ttu-id="cb31c-472">Si hay una solicitud que coincida con una ruta, será final.</span><span class="sxs-lookup"><span data-stu-id="cb31c-472">Terminal if a request matches a route.</span></span> |
| [<span data-ttu-id="cb31c-473">OWIN</span><span class="sxs-lookup"><span data-stu-id="cb31c-473">OWIN</span></span>](xref:fundamentals/owin) | <span data-ttu-id="cb31c-474">Puede interoperar con aplicaciones, servidores y software intermedio basados en OWIN.</span><span class="sxs-lookup"><span data-stu-id="cb31c-474">Interop with OWIN-based apps, servers, and middleware.</span></span> | <span data-ttu-id="cb31c-475">Si el software intermedio de OWIN procesa completamente la solicitud, será final.</span><span class="sxs-lookup"><span data-stu-id="cb31c-475">Terminal if the OWIN Middleware fully processes the request.</span></span> |
| [<span data-ttu-id="cb31c-476">Almacenamiento en caché de respuestas</span><span class="sxs-lookup"><span data-stu-id="cb31c-476">Response Caching</span></span>](xref:performance/caching/middleware) | <span data-ttu-id="cb31c-477">Proporciona compatibilidad con la captura de respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-477">Provides support for caching responses.</span></span> | <span data-ttu-id="cb31c-478">Antes de los componentes que requieren el almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="cb31c-478">Before components that require caching.</span></span> |
| [<span data-ttu-id="cb31c-479">Compresión de respuesta</span><span class="sxs-lookup"><span data-stu-id="cb31c-479">Response Compression</span></span>](xref:performance/response-compression) | <span data-ttu-id="cb31c-480">Proporciona compatibilidad con la compresión de respuestas.</span><span class="sxs-lookup"><span data-stu-id="cb31c-480">Provides support for compressing responses.</span></span> | <span data-ttu-id="cb31c-481">Antes de los componentes que requieren compresión.</span><span class="sxs-lookup"><span data-stu-id="cb31c-481">Before components that require compression.</span></span> |
| [<span data-ttu-id="cb31c-482">Localización de solicitudes</span><span class="sxs-lookup"><span data-stu-id="cb31c-482">Request Localization</span></span>](xref:fundamentals/localization) | <span data-ttu-id="cb31c-483">Proporciona compatibilidad con ubicación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-483">Provides localization support.</span></span> | <span data-ttu-id="cb31c-484">Antes de los componentes que dependen de la ubicación.</span><span class="sxs-lookup"><span data-stu-id="cb31c-484">Before localization sensitive components.</span></span> |
| [<span data-ttu-id="cb31c-485">Enrutamiento de punto de conexión</span><span class="sxs-lookup"><span data-stu-id="cb31c-485">Endpoint Routing</span></span>](xref:fundamentals/routing) | <span data-ttu-id="cb31c-486">Define y restringe las rutas de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="cb31c-486">Defines and constrains request routes.</span></span> | <span data-ttu-id="cb31c-487">Terminal para rutas que coincidan.</span><span class="sxs-lookup"><span data-stu-id="cb31c-487">Terminal for matching routes.</span></span> |
| [<span data-ttu-id="cb31c-488">Sesión</span><span class="sxs-lookup"><span data-stu-id="cb31c-488">Session</span></span>](xref:fundamentals/app-state) | <span data-ttu-id="cb31c-489">Proporciona compatibilidad con la administración de sesiones de usuario.</span><span class="sxs-lookup"><span data-stu-id="cb31c-489">Provides support for managing user sessions.</span></span> | <span data-ttu-id="cb31c-490">Antes de los componentes que requieren Session.</span><span class="sxs-lookup"><span data-stu-id="cb31c-490">Before components that require Session.</span></span> |
| [<span data-ttu-id="cb31c-491">Archivos estáticos</span><span class="sxs-lookup"><span data-stu-id="cb31c-491">Static Files</span></span>](xref:fundamentals/static-files) | <span data-ttu-id="cb31c-492">Proporciona compatibilidad con la proporción de archivos estáticos y la exploración de directorios.</span><span class="sxs-lookup"><span data-stu-id="cb31c-492">Provides support for serving static files and directory browsing.</span></span> | <span data-ttu-id="cb31c-493">Si hay una solicitud que coincida con un archivo, será final.</span><span class="sxs-lookup"><span data-stu-id="cb31c-493">Terminal if a request matches a file.</span></span> |
| [<span data-ttu-id="cb31c-494">Reescritura de URL</span><span class="sxs-lookup"><span data-stu-id="cb31c-494">URL Rewrite</span></span>](xref:fundamentals/url-rewriting) | <span data-ttu-id="cb31c-495">Proporciona compatibilidad con la reescritura de direcciones URL y la redirección de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="cb31c-495">Provides support for rewriting URLs and redirecting requests.</span></span> | <span data-ttu-id="cb31c-496">Antes de los componentes que consumen la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="cb31c-496">Before components that consume the URL.</span></span> |
| [<span data-ttu-id="cb31c-497">WebSockets</span><span class="sxs-lookup"><span data-stu-id="cb31c-497">WebSockets</span></span>](xref:fundamentals/websockets) | <span data-ttu-id="cb31c-498">Habilita el protocolo WebSockets.</span><span class="sxs-lookup"><span data-stu-id="cb31c-498">Enables the WebSockets protocol.</span></span> | <span data-ttu-id="cb31c-499">Antes de los componentes necesarios para aceptar solicitudes de WebSocket.</span><span class="sxs-lookup"><span data-stu-id="cb31c-499">Before components that are required to accept WebSocket requests.</span></span> |

## <a name="additional-resources"></a><span data-ttu-id="cb31c-500">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="cb31c-500">Additional resources</span></span>

* <xref:fundamentals/middleware/write>
* <xref:test/middleware>
* <xref:migration/http-modules>
* <xref:fundamentals/startup>
* <xref:fundamentals/request-features>
* <xref:fundamentals/middleware/extensibility>
* <xref:fundamentals/middleware/extensibility-third-party-container>

::: moniker-end
